/*-----------------copyright(c)------------------------------------------------------------------------------------------------------------------*/
/*文件名：LCD.c
 * 作者：李超
 * 时间：3015/3/18
 * 使用范围：MSP430FW427,适用于能联第一版的板子
 * 备注：
 *
 * */
/*-------------------------------------------------------------------------------------------------------------------------------------------------*/
#include "I2C.h"

#define I2C_SDA_DIR_IN				I2C_SDA_PORT_DIR &= ~I2C_SDA_BIT
#define I2C_SDA_DIR_OUT				I2C_SDA_PORT_DIR   |=   I2C_SDA_BIT

#define I2C_SCL_DIR_IN					I2C_SCL_PORT_DIR	&=~I2C_SCL_BIT
#define I2C_SCL_DIR_OUT				I2C_SCL_PORT_DIR   |=   I2C_SCL_BIT

#define I2C_WP_DIR_IN					I2C_WP_PORT_DIR &=~I2C_WP_BIT
#define I2C_WP_DIR_OUT				I2C_WP_PORT_DIR 	|=   I2C_WP_BIT

#define I2C_SDA_SET						I2C_SDA_PORT_OUT |= I2C_SDA_BIT
#define I2C_SDA_RESET					I2C_SDA_PORT_OUT &= ~I2C_SDA_BIT

#define I2C_SCL_SET						I2C_SCL_PORT_OUT |= I2C_SCL_BIT
#define I2C_SCL_RESET					I2C_SCL_PORT_OUT &= ~I2C_SCL_BIT

#define I2C_WP_SET						I2C_WP_PORT_OUT |= I2C_WP_BIT
#define I2C_WP_RESET					I2C_WP_PORT_OUT &= ~I2C_WP_BIT
/*---------------------------------------------------------------------------------------------------------------------------------------------------
 * 名称：void Delay_I2C(unsigned int  time)
 * 功能：I2C延时函数
 * 输入：无
 * 输出：无
 * 作者：李超
 * 版本：1.0
 * 备注：
---------------------------------------------------------------------------------------------------------------------------------------------------*/
void Delay_I2C(unsigned int  time)
{
	unsigned int i,j;
	for(i=time;i>0;i--)
		for(j=3;j>0;j--);
}
void I2C_WP_H(void)
{
	I2C_WP_SET;
}
void I2C_WP_L(void)
{
	I2C_WP_RESET;
}
/*---------------------------------------------------------------------------------------------------------------------------------------------------
 * 名称：void I2C_SDA_H(void)
 * 功能：SDA设置为高，并延时
 * 输入：无
 * 输出：无
 * 作者：李超
 * 版本：1.0
 * 备注：
---------------------------------------------------------------------------------------------------------------------------------------------------*/
void I2C_SDA_H(void)
{
	I2C_SDA_SET;
	Delay_I2C(DELAY_TIME);
}
/*---------------------------------------------------------------------------------------------------------------------------------------------------
 * 名称：void I2C_SDA_L(void)
 * 功能DA设置为低，并延时
 * 输入：无
 * 输出：无
 * 作者：李超
 * 版本：1.0
 * 备注：
---------------------------------------------------------------------------------------------------------------------------------------------------*/
void I2C_SDA_L(void)
{
	I2C_SDA_RESET;
	Delay_I2C(DELAY_TIME);
}
/*---------------------------------------------------------------------------------------------------------------------------------------------------
 * 名称：void I2C_SCL_H(void)
 * 功能：SCL设置为高，并延时
 * 输入：无
 * 输出：无
 * 作者：李超
 * 版本：1.0
 * 备注：
---------------------------------------------------------------------------------------------------------------------------------------------------*/
void I2C_SCL_H(void)
{
	I2C_SCL_SET;
	Delay_I2C(DELAY_TIME);
}
/*---------------------------------------------------------------------------------------------------------------------------------------------------
 * 名称：void I2C_SCL_L(void)
 * 功能：SCL设置为低，并延时
 * 输入：无
 * 输出：无
 * 作者：李超
 * 版本：1.0
 * 备注：
---------------------------------------------------------------------------------------------------------------------------------------------------*/
void I2C_SCL_L(void)
{
	I2C_SCL_RESET;
	Delay_I2C(DELAY_TIME);
}
/*---------------------------------------------------------------------------------------------------------------------------------------------------
 * 名称：unsigned char I2C_SDA_Read(void)
 * 功能：读SDA的状态
 * 输入：无
 * 输出：unsigned char ：SDA的状态
 * 作者：李超
 * 版本：1.0
 * 备注：
---------------------------------------------------------------------------------------------------------------------------------------------------*/
unsigned char I2C_SDA_Read(void)
{
	Delay_I2C(DELAY_TIME);
	if (I2C_SDA_PORT_IN & I2C_SDA_BIT)
		return 1;
	else
		return 0;
}
/*---------------------------------------------------------------------------------------------------------------------------------------------------
 * 名称：void I2C_Init(void)
 * 功能：I2C初始化
 * 输入：无
 * 输出：无
 * 作者：李超
 * 版本：1.0
 * 备注：
---------------------------------------------------------------------------------------------------------------------------------------------------*/
void I2C_Init(void)
{
	I2C_SDA_PORT_SEL	&= ~I2C_SDA_BIT;
	I2C_SCL_PORT_SEL &= ~ I2C_SCL_BIT;
	I2C_WP_PORT_SEL &= ~I2C_WP_BIT;
	I2C_WP_DIR_OUT;
	I2C_SCL_DIR_OUT;
	I2C_SDA_DIR_OUT;
	I2C_WP_L();
	I2C_SDA_H();
	I2C_SCL_H();
}
/*---------------------------------------------------------------------------------------------------------------------------------------------------
 * 名称：void I2C_Start(void)
 * 功能：起始信号
 * 输入：无
 * 输出：无
 * 作者：李超
 * 版本：1.0
 * 备注：
---------------------------------------------------------------------------------------------------------------------------------------------------*/
void I2C_Start(void)
{
	Delay_I2C(DELAY_TIME);
	Delay_I2C(DELAY_TIME);
	Delay_I2C(DELAY_TIME);
	Delay_I2C(DELAY_TIME);
	Delay_I2C(DELAY_TIME);
	I2C_SDA_DIR_OUT;
	I2C_SDA_H();
	I2C_SCL_H();
	I2C_SDA_L();
	I2C_SCL_L();
}
/*---------------------------------------------------------------------------------------------------------------------------------------------------
 * 名称：void I2C_Stop(void)
 * 功能：结束信号
 * 输入：无
 * 输出：无
 * 作者：李超
 * 版本：1.0
 * 备注：
---------------------------------------------------------------------------------------------------------------------------------------------------*/
void I2C_Stop(void)
{
	I2C_SCL_L();
	I2C_SDA_DIR_OUT;
	I2C_SDA_L();
	I2C_SCL_H();
	I2C_SDA_H();
}
/*---------------------------------------------------------------------------------------------------------------------------------------------------
 * 名称：void I2C_ACK(void)
 * 功能：应答
 * 输入：无
 * 输出：无
 * 作者：李超
 * 版本：1.0
 * 备注：
---------------------------------------------------------------------------------------------------------------------------------------------------*/
void I2C_ACK(void)
{
	I2C_SDA_DIR_OUT;
	I2C_SDA_L();
	I2C_SCL_H();
}
/*---------------------------------------------------------------------------------------------------------------------------------------------------
 * 名称：void I2C_NoACK(void)
 * 功能：非应答
 * 输入：无
 * 输出：无
 * 作者：李超
 * 版本：1.0
 * 备注：
---------------------------------------------------------------------------------------------------------------------------------------------------*/
void I2C_NoACK(void)
{
	I2C_SDA_DIR_OUT;
	I2C_SDA_H();
	I2C_SCL_H();
}
/*---------------------------------------------------------------------------------------------------------------------------------------------------
 * 名称：unsigned char I2C_WriteByte(unsigned char byte)
 * 功能：写一个字节
 * 输入：unsigned char byte：需要写入的字节
 * 输出：无
 * 作者：李超
 * 版本：1.0
 * 备注：
---------------------------------------------------------------------------------------------------------------------------------------------------*/
unsigned char I2C_WriteByte(unsigned char byte)
{
	unsigned char i;
	I2C_SCL_L();
	I2C_SDA_DIR_OUT;
	for(i=0; i<8; i++)
	{
		if(byte&0x80)
		{
			I2C_SDA_H();
		}
		else
		{
			I2C_SDA_L();
		}
		I2C_SCL_H();
		byte = byte<<1;
		I2C_SCL_L();
	}
	I2C_SDA_DIR_IN;
	I2C_SDA_Read();
	I2C_SCL_H();
	i=0;
	while(I2C_SDA_Read())
	{
		if(++i>12)
		{
			I2C_SCL_L();
			return 0;
		}
	}
	I2C_SCL_L();
	return 1;
}
/*---------------------------------------------------------------------------------------------------------------------------------------------------
 * 名称：unsigned char I2C_ReadByte(void)
 * 功能：读一个字节
 * 输入：无
 * 输出：unsigned char：读出的字节
 * 作者：李超
 * 版本：1.0
 * 备注：
---------------------------------------------------------------------------------------------------------------------------------------------------*/
unsigned char I2C_ReadByte(void)
{
	unsigned char temp,i;
	temp = 0;
	I2C_SCL_L();
	I2C_SDA_DIR_IN;
	for(i=0;i<8;i++)
	{
		I2C_SCL_H();
		temp <<=1;
		temp |= I2C_SDA_Read();
		I2C_SCL_L();
	}
	return temp;
}
/***************************************************************************************/





